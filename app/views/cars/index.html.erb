<% content_for :title, "–ù–∞—à–∏ –≤–æ–∑–∏–ª–∞ - autorentalsMK" %>

<!-- Filters Section -->
<section class="filters-section">
  <div class="container">
    <div class="filters-header">
      <h2 class="filters-title">–ù–∞—ò–¥–µ—Ç–µ –≥–æ –≤–∞—à–µ—Ç–æ —Å–æ–≤—Ä—à–µ–Ω–æ –≤–æ–∑–∏–ª–æ</h2>
      <p class="filters-subtitle">–§–∏–ª—Ç—Ä–∏—Ä–∞—ò—Ç–µ —ò–∞ –Ω–∞—à–∞—Ç–∞ –ø—Ä–µ–º–∏—É–º —Ñ–ª–æ—Ç–∞ –∑–∞ –¥–∞ —Å–µ —Å–æ–≤–ø–∞–¥–Ω–µ —Å–æ –≤–∞—à–∏—Ç–µ –ø—Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ –∏ –¥–∞—Ç—É–º–∏</p>
    </div>
    <%= form_with url: cars_path, method: :get, data: { turbo_frame: "cars-list" }, class: "filters-form" do |form| %>
      <div class="filters-container">
        <!-- Date Availability Filters -->
        <div class="date-availability-section">
          <h4 class="filter-section-title">–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–æ—Å—Ç–∞–ø–Ω–æ—Å—Ç</h4>
          <div class="date-filters">
            <div class="filter-group">
              <label class="filter-label">–î–∞—Ç—É–º –Ω–∞ –ø–æ–¥–∏–≥–∞—ö–µ</label>
              <%= form.date_field :start_date, 
                  value: params[:start_date], 
                  min: Date.current,
                  class: "filter-input" %>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">–î–∞—Ç—É–º –Ω–∞ –≤—Ä–∞—ú–∞—ö–µ</label>
              <%= form.date_field :end_date, 
                  value: params[:end_date], 
                  min: Date.current + 1.day,
                  class: "filter-input" %>
            </div>
          </div>
          
          <% if @date_filtered %>
            <div class="date-filter-status">
              <span class="status-icon">‚úÖ</span>
              <span>–ü—Ä–∏–∫–∞–∂—É–≤–∞–º –≤–æ–∑–∏–ª–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –æ–¥ <%= @filter_start_date.strftime("%b %d") %> –¥–æ <%= @filter_end_date.strftime("%b %d, %Y") %></span>
              <%= link_to "–ò–∑–±—Ä–∏—à–∏ –¥–∞—Ç—É–º–∏", cars_path(brand: params[:brand], year_from: params[:year_from], year_to: params[:year_to], max_price: params[:max_price]), class: "clear-dates-btn" %>
            </div>
          <% end %>
        </div>

        <!-- Other Filters -->
        <div class="other-filters-section">
          <h4 class="filter-section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ñ–∏–ª—Ç—Ä–∏</h4>
          <div class="other-filters">
            <div class="filter-group">
              <label class="filter-label">–ú–∞—Ä–∫–∞</label>
              <%= form.text_field :brand, value: params[:brand], placeholder: "–Ω–∞ –ø—Ä. BMW, Mercedes", class: "filter-input" %>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">–ì–æ–¥–∏–Ω–∞ –æ–¥</label>
              <%= form.number_field :year_from, value: params[:year_from], placeholder: "2020", class: "filter-input" %>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">–ì–æ–¥–∏–Ω–∞ –¥–æ</label>
              <%= form.number_field :year_to, value: params[:year_to], placeholder: "2025", class: "filter-input" %>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">–ú–∞–∫—Å. —Ü–µ–Ω–∞/–¥–µ–Ω</label>
              <%= form.number_field :max_price, value: params[:max_price], placeholder: "500", step: 0.01, class: "filter-input" %>
            </div>
          </div>
        </div>
        
        <div class="filters-actions">
          <%= form.submit "–§–∏–ª—Ç—Ä–∏—Ä–∞—ò –≤–æ–∑–∏–ª–∞", class: "btn btn-primary btn-filter" %>
          <%= link_to "–†–µ—Å–µ—Ç–∏—Ä–∞—ò —Å–µ", cars_path, class: "btn btn-secondary btn-filter" %>
        </div>
      </div>
    <% end %>
  </div>
</section>

<!-- Cars Content -->
<section class="cars-content" data-controller="cars">
  <div class="container">
    <%= turbo_frame_tag "cars-list" do %>
      <% if @cars.any? %>
        <div class="cars-grid" data-cars-target="grid">
          <% @cars.each do |car| %>
            <div class="car-card" data-cars-target="card">
              <div class="car-image-wrapper">
                <img src="<%= car.image_url %>" alt="<%= car.full_name %>" class="car-image">
                <div class="car-status-badge <%= car.available? ? 'available' : 'unavailable' %>">
                  <%= car.available? ? '–î–æ—Å—Ç–∞–ø–Ω–æ' : '–ù–µ–¥–æ—Å—Ç–∞–ø–Ω–æ' %>
                </div>
                <div class="car-year-badge"><%= car.year %></div>
              </div>
              
              <div class="car-details">
                <div class="car-brand"><%= car.brand %></div>
                <h3 class="car-name"><%= car.model %></h3>
                
                <div class="car-specs">
                  <div class="car-spec">
                    <span class="car-spec-icon">üìÖ</span>
                    <span><%= car.year %></span>
                  </div>
                  <div class="car-spec">
                    <span class="car-spec-icon">‚ö°</span>
                    <span>
                      <% if @date_filtered %>
                        –î–æ—Å—Ç–∞–ø–Ω–æ –∑–∞ –≤–∞—à–∏—Ç–µ –¥–∞—Ç—É–º–∏
                      <% elsif car.available? %>
                        –î–æ—Å—Ç–∞–ø–Ω–æ
                      <% else %>
                        –ú–æ–º–µ–Ω—Ç–∞–ª–Ω–æ –Ω–µ–¥–æ—Å—Ç–∞–ø–Ω–æ
                      <% end %>
                    </span>
                  </div>
                  <div class="car-spec">
                    <span class="car-spec-icon">üõ°Ô∏è</span>
                    <span>–û—Å–∏–≥—É—Ä–∞–Ω–æ</span>
                  </div>
                  <div class="car-spec">
                    <span class="car-spec-icon">üîß</span>
                    <span>–û–¥—Ä–∂—É–≤–∞–Ω–æ</span>
                  </div>
                </div>
                
                <p class="car-description-preview"><%= car.description %></p>
                
                <div class="car-actions">
                  <div class="car-price-display">
                    <div class="car-price">‚Ç¨<%= car.price_per_day %></div>
                    <div class="car-price-unit">–Ω–∞ –¥–µ–Ω</div>
                  </div>

                  <div class="car-action-buttons">
                    <%= link_to "–ü–æ–≥–ª–µ–¥–Ω–∏ –¥–µ—Ç–∞–ª–∏", car_path(car), class: "btn btn-secondary car-view-btn", data: { turbo_frame: "_top" } %>
                    
                    <% if @date_filtered %>
                      <%= link_to "–ò—Å–ø—Ä–∞—Ç–∏ –±–∞—Ä–∞—ö–µ", new_car_booking_inquiry_path(car, start_date: @filter_start_date, end_date: @filter_end_date), 
                          class: "btn btn-primary car-book-btn", data: { turbo_frame: "_top" } %>
                    <% else %>
                      <%= link_to "–ò—Å–ø—Ä–∞—Ç–∏ –±–∞—Ä–∞—ö–µ", new_car_booking_inquiry_path(car), 
                          class: "btn btn-primary car-book-btn", data: { turbo_frame: "_top" } %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">üöó</div>
          <h3>–ù–µ —Å–µ –ø—Ä–æ–Ω–∞—ò–¥–µ–Ω–∏ –≤–æ–∑–∏–ª–∞</h3>
          <p>–û–±–∏–¥–µ—Ç–µ —Å–µ –¥–∞ –≥–∏ –ø—Ä–∏–ª–∞–≥–æ–¥–∏—Ç–µ –≤–∞—à–∏—Ç–µ —Ñ–∏–ª—Ç—Ä–∏ –∑–∞ –¥–∞ –≥–æ –Ω–∞—ò–¥–µ—Ç–µ —Å–æ–≤—Ä—à–µ–Ω–æ—Ç–æ –≤–æ–∑–∏–ª–æ –∑–∞ –≤–∞—Å.</p>
          <%= link_to "–†–µ—Å–µ—Ç–∏—Ä–∞—ò —Ñ–∏–ª—Ç—Ä–∏", cars_path, class: "btn btn-primary" %>
        </div>
      <% end %>
    <% end %>
  </div>
</section>
